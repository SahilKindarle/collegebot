<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/SpeechKITT/0.3.0/speechkitt.min.js"></script>

<script>
    if (annyang) {


        var synthesis = window.speechSynthesis
        var utterance = new SpeechSynthesisUtterance()
        var voices, lekha
        setTimeout(() => {
            voices = synthesis.getVoices()
            lekha = voices.filter(voice => voice.name == 'Lekha')[0]
            utterance.voice = lekha

            if (!lekha) {
                lekha = voices.filter(voice => voice.name == 'Google हिन्दी')[0]
            }
        }, 1000)

        utterance.voice = lekha
        console.log(synthesis)
        utterance.pitch = 1
        utterance.rate = 0.9

        // Let's define our first command. First the text we expect, and then the function it should call
        // var commands = {
        //     "find details of :name": function (name) {

        //         fetch("/search/" + name)
        //             .then(resp => resp.json())
        //             .then(data => {
        //                 console.log(data);
        //             })
        //     }
        // }

        // Add our commands to annyang
        annyang.addCommands({
            'hello': sayHello,
            'hi': sayHello,
            'namaste': sayHello,
            'namaskar': sayHello,
            "find details of :name": function (name) {

                fetch("/search/" + name)
                    .then(resp => resp.json())
                    .then(data => {
                        console.log(data);
                    })
            }

        });

        function sayHello() {
            // alert('Hello world!')
            let msg = {
                from: 'machine',
                text: 'नमस्कार!'
                // text: 'Hi!'
            }

            conversationVue.messages.push(msg)
            utterance.text = msg.text
            utterance.voice = lekha
            annyang.abort()
            synthesis.speak(utterance)
        }

        // Start listening. You can call this here, or attach this call to an event, button, etc.
        // annyang.start();


        // Tell KITT to use annyang
        SpeechKITT.annyang()

        // Define a stylesheet for KITT to use
        SpeechKITT.setStylesheet(
            '/css/flat-pumpkin.css'
        )
        SpeechKITT.setInstructionsText('Listening...')
        // SpeechKITT.displayRecognizedSentence({
        // 	newState: true
        // })

        // Render KITT's interface
        SpeechKITT.vroom()
    }
</script>